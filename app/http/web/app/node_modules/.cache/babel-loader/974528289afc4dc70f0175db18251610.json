{"ast":null,"code":"//    abc_voice_element.js: Definition of the VoiceElement class.\n//    Copyright (C) 2010-2018 Gregory Dyke (gregdyke at gmail dot com) and Paul Rosen\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\nvar parseCommon = require('../parse/abc_common');\n\nvar VoiceElement = function VoiceElement(voicenumber, voicetotal) {\n  this.children = [];\n  this.beams = [];\n  this.otherchildren = []; // ties, slurs, triplets\n\n  this.w = 0;\n  this.duplicate = false;\n  this.voicenumber = voicenumber; //number of the voice on a given stave (not staffgroup)\n\n  this.voicetotal = voicetotal;\n  this.bottom = 7;\n  this.top = 7;\n  this.specialY = {\n    tempoHeightAbove: 0,\n    partHeightAbove: 0,\n    volumeHeightAbove: 0,\n    dynamicHeightAbove: 0,\n    endingHeightAbove: 0,\n    chordHeightAbove: 0,\n    lyricHeightAbove: 0,\n    lyricHeightBelow: 0,\n    chordHeightBelow: 0,\n    volumeHeightBelow: 0,\n    dynamicHeightBelow: 0\n  };\n};\n\nVoiceElement.prototype.addChild = function (child) {\n  if (child.type === 'bar') {\n    var firstItem = true;\n\n    for (var i = 0; firstItem && i < this.children.length; i++) {\n      if (this.children[i].type !== \"staff-extra\") firstItem = false;\n    }\n\n    if (!firstItem) {\n      this.beams.push(\"bar\");\n      this.otherchildren.push(\"bar\");\n    }\n  }\n\n  this.children[this.children.length] = child;\n  this.setRange(child);\n};\n\nVoiceElement.prototype.setLimit = function (member, child) {\n  // Sometimes we get an absolute element in here and sometimes we get some type of relative element.\n  // If there is a \"specialY\" element, then assume it is an absolute element. If that doesn't exist, look for the\n  // same members at the top level, because that's where they are in relative elements.\n  var specialY = child.specialY;\n  if (!specialY) specialY = child;\n  if (!specialY[member]) return;\n  if (!this.specialY[member]) this.specialY[member] = specialY[member];else this.specialY[member] = Math.max(this.specialY[member], specialY[member]);\n};\n\nVoiceElement.prototype.moveDecorations = function (beam) {\n  var padding = 1.5; // This is the vertical padding between elements, in pitches.\n\n  for (var ch = 0; ch < beam.elems.length; ch++) {\n    var child = beam.elems[ch];\n\n    if (child.top) {\n      // We now know where the ornaments should have been placed, so move them if they would overlap.\n      var top = beam.yAtNote(child);\n\n      for (var i = 0; i < child.children.length; i++) {\n        var el = child.children[i];\n\n        if (el.klass === 'ornament') {\n          if (el.bottom - padding < top) {\n            var distance = top - el.bottom + padding; // Find the distance that it needs to move and add a little margin so the element doesn't touch the beam.\n\n            el.bottom += distance;\n            el.top += distance;\n            el.pitch += distance;\n            top = child.top = el.top;\n          }\n        }\n      }\n    }\n  }\n};\n\nVoiceElement.prototype.adjustRange = function (child) {\n  if (child.bottom !== undefined) this.bottom = Math.min(this.bottom, child.bottom);\n  if (child.top !== undefined) this.top = Math.max(this.top, child.top);\n};\n\nVoiceElement.prototype.setRange = function (child) {\n  this.adjustRange(child);\n  this.setLimit('tempoHeightAbove', child);\n  this.setLimit('partHeightAbove', child);\n  this.setLimit('volumeHeightAbove', child);\n  this.setLimit('dynamicHeightAbove', child);\n  this.setLimit('endingHeightAbove', child);\n  this.setLimit('chordHeightAbove', child);\n  this.setLimit('lyricHeightAbove', child);\n  this.setLimit('lyricHeightBelow', child);\n  this.setLimit('chordHeightBelow', child);\n  this.setLimit('volumeHeightBelow', child);\n  this.setLimit('dynamicHeightBelow', child);\n};\n\nVoiceElement.prototype.setUpperAndLowerElements = function (positionY) {\n  var i;\n\n  for (i = 0; i < this.children.length; i++) {\n    var abselem = this.children[i];\n    abselem.setUpperAndLowerElements(positionY);\n  }\n\n  for (i = 0; i < this.otherchildren.length; i++) {\n    var abselem = this.otherchildren[i];\n    if (typeof abselem !== 'string') abselem.setUpperAndLowerElements(positionY);\n  }\n};\n\nVoiceElement.prototype.addOther = function (child) {\n  this.otherchildren.push(child);\n  this.setRange(child);\n};\n\nVoiceElement.prototype.addBeam = function (child) {\n  this.beams.push(child);\n};\n\nVoiceElement.prototype.updateIndices = function () {\n  if (!this.layoutEnded()) {\n    this.durationindex += this.children[this.i].duration;\n    if (this.children[this.i].duration === 0) this.durationindex = Math.round(this.durationindex * 64) / 64; // everytime we meet a barline, do rounding to nearest 64th\n\n    this.i++;\n  }\n};\n\nVoiceElement.prototype.layoutEnded = function () {\n  return this.i >= this.children.length;\n};\n\nVoiceElement.prototype.getDurationIndex = function () {\n  return this.durationindex - (this.children[this.i] && this.children[this.i].duration > 0 ? 0 : 0.0000005); // if the ith element doesn't have a duration (is not a note), its duration index is fractionally before. This enables CLEF KEYSIG TIMESIG PART, etc. to be laid out before we get to the first note of other voices\n}; // number of spacing units expected for next positioning\n\n\nVoiceElement.prototype.getSpacingUnits = function () {\n  return Math.sqrt(this.spacingduration * 8); // TODO-PER: On short lines, this would never trigger, so the spacing was wrong. I just changed this line empirically, though, so I don't know if there are other ramifications.\n  //return (this.minx<this.nextx) ? Math.sqrt(this.spacingduration*8) : 0; // we haven't used any spacing units if we end up using minx\n}; //\n\n\nVoiceElement.prototype.getNextX = function () {\n  return Math.max(this.minx, this.nextx);\n};\n\nVoiceElement.prototype.beginLayout = function (startx) {\n  this.i = 0;\n  this.durationindex = 0; //this.ii=this.children.length;\n\n  this.startx = startx;\n  this.minx = startx; // furthest left to where negatively positioned elements are allowed to go\n\n  this.nextx = startx; // x position where the next element of this voice should be placed assuming no other voices and no fixed width constraints\n\n  this.spacingduration = 0; // duration left to be laid out in current iteration (omitting additional spacing due to other aspects, such as bars, dots, sharps and flats)\n}; // Try to layout the element at index this.i\n// x - position to try to layout the element at\n// spacing - base spacing\n// can't call this function more than once per iteration\n\n\nVoiceElement.prototype.layoutOneItem = function (x, spacing) {\n  var child = this.children[this.i];\n  if (!child) return 0;\n  var er = x - this.minx; // available extrawidth to the left\n\n  if (er < child.getExtraWidth()) {\n    // shift right by needed amount\n    x += child.getExtraWidth() - er;\n  }\n\n  child.setX(x);\n  this.spacingduration = child.duration; //update minx\n\n  this.minx = x + child.getMinWidth(); // add necessary layout space\n\n  if (this.i !== this.children.length - 1) this.minx += child.minspacing; // add minimumspacing except on last elem\n\n  this.updateNextX(x, spacing); // contribute to staff y position\n  //this.staff.top = Math.max(child.top,this.staff.top);\n  //this.staff.bottom = Math.min(child.bottom,this.staff.bottom);\n\n  return x; // where we end up having placed the child\n}; // call when spacingduration has been updated\n\n\nVoiceElement.prototype.updateNextX = function (x, spacing) {\n  this.nextx = x + spacing * Math.sqrt(this.spacingduration * 8);\n};\n\nVoiceElement.prototype.shiftRight = function (dx) {\n  var child = this.children[this.i];\n  if (!child) return;\n  child.setX(child.x + dx);\n  this.minx += dx;\n  this.nextx += dx;\n};\n\nVoiceElement.prototype.draw = function (renderer, bartop) {\n  var width = this.w - 1;\n  renderer.staffbottom = this.staff.bottom; //this.barbottom = renderer.calcY(2);\n\n  renderer.measureNumber = null;\n  renderer.noteNumber = null;\n\n  if (this.header) {\n    // print voice name\n    var textpitch = 14 - (this.voicenumber + 1) * (12 / (this.voicetotal + 1));\n    renderer.renderText(renderer.padding.left, renderer.calcY(textpitch), this.header, 'voicefont', 'staff-extra voice-name', 'start');\n  }\n\n  for (var i = 0, ii = this.children.length; i < ii; i++) {\n    var child = this.children[i];\n    var justInitializedMeasureNumber = false;\n\n    if (child.type !== 'staff-extra' && renderer.measureNumber === null) {\n      renderer.measureNumber = 0;\n      renderer.noteNumber = 0;\n      justInitializedMeasureNumber = true;\n    }\n\n    child.draw(renderer, this.barto || i === ii - 1 ? bartop : 0);\n    if (child.type === 'note') renderer.noteNumber++;\n\n    if (child.type === 'bar' && !justInitializedMeasureNumber) {\n      renderer.measureNumber++;\n      renderer.noteNumber = 0;\n    }\n  }\n\n  renderer.measureNumber = 0;\n  renderer.noteNumber = 0;\n  parseCommon.each(this.beams, function (beam) {\n    if (beam === 'bar') {\n      renderer.measureNumber++;\n      renderer.noteNumber = 0;\n    } else beam.draw(renderer); // beams must be drawn first for proper printing of triplets, slurs and ties.\n\n  });\n  renderer.measureNumber = 0;\n  renderer.noteNumber = 0;\n  var self = this;\n  parseCommon.each(this.otherchildren, function (child) {\n    if (child === 'bar') {\n      renderer.measureNumber++;\n      renderer.noteNumber = 0;\n    } else child.draw(renderer, self.startx + 10, width);\n  });\n};\n\nVoiceElement.prototype.layoutBeams = function () {\n  for (var i = 0; i < this.beams.length; i++) {\n    if (this.beams[i].layout) {\n      this.beams[i].layout();\n      this.moveDecorations(this.beams[i]); // The above will change the top and bottom of the abselem children, so see if we need to expand our range.\n\n      for (var j = 0; j < this.beams[i].elems.length; j++) {\n        this.adjustRange(this.beams[i].elems[j]);\n      }\n    }\n  } // Now we can layout the triplets\n\n\n  for (i = 0; i < this.otherchildren.length; i++) {\n    var child = this.otherchildren[i];\n    if (child.layout) child.layout();\n  }\n\n  this.staff.top = Math.max(this.staff.top, this.top);\n  this.staff.bottom = Math.min(this.staff.bottom, this.bottom);\n};\n\nmodule.exports = VoiceElement;","map":{"version":3,"sources":["/Users/philbrockman/coding/MusicalGens/app/http/web/app/node_modules/abcjs/src/write/abc_voice_element.js"],"names":["parseCommon","require","VoiceElement","voicenumber","voicetotal","children","beams","otherchildren","w","duplicate","bottom","top","specialY","tempoHeightAbove","partHeightAbove","volumeHeightAbove","dynamicHeightAbove","endingHeightAbove","chordHeightAbove","lyricHeightAbove","lyricHeightBelow","chordHeightBelow","volumeHeightBelow","dynamicHeightBelow","prototype","addChild","child","type","firstItem","i","length","push","setRange","setLimit","member","Math","max","moveDecorations","beam","padding","ch","elems","yAtNote","el","klass","distance","pitch","adjustRange","undefined","min","setUpperAndLowerElements","positionY","abselem","addOther","addBeam","updateIndices","layoutEnded","durationindex","duration","round","getDurationIndex","getSpacingUnits","sqrt","spacingduration","getNextX","minx","nextx","beginLayout","startx","layoutOneItem","x","spacing","er","getExtraWidth","setX","getMinWidth","minspacing","updateNextX","shiftRight","dx","draw","renderer","bartop","width","staffbottom","staff","measureNumber","noteNumber","header","textpitch","renderText","left","calcY","ii","justInitializedMeasureNumber","barto","each","self","layoutBeams","layout","j","module","exports"],"mappings":"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","sourcesContent":["//    abc_voice_element.js: Definition of the VoiceElement class.\n//    Copyright (C) 2010-2018 Gregory Dyke (gregdyke at gmail dot com) and Paul Rosen\n//\n//    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n//    documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation\n//    the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n//    to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n//\n//    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n//\n//    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING\n//    BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n//    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n//    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n//    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar parseCommon = require('../parse/abc_common');\n\nvar VoiceElement = function VoiceElement(voicenumber, voicetotal) {\n\tthis.children = [];\n\tthis.beams = [];\n\tthis.otherchildren = []; // ties, slurs, triplets\n\tthis.w = 0;\n\tthis.duplicate = false;\n\tthis.voicenumber = voicenumber; //number of the voice on a given stave (not staffgroup)\n\tthis.voicetotal = voicetotal;\n\tthis.bottom = 7;\n\tthis.top = 7;\n\tthis.specialY = {\n\t\ttempoHeightAbove: 0,\n\t\tpartHeightAbove: 0,\n\t\tvolumeHeightAbove: 0,\n\t\tdynamicHeightAbove: 0,\n\t\tendingHeightAbove: 0,\n\t\tchordHeightAbove: 0,\n\t\tlyricHeightAbove: 0,\n\n\t\tlyricHeightBelow: 0,\n\t\tchordHeightBelow: 0,\n\t\tvolumeHeightBelow: 0,\n\t\tdynamicHeightBelow: 0\n\t};\n};\n\nVoiceElement.prototype.addChild = function (child) {\n\tif (child.type === 'bar') {\n\t\tvar firstItem = true;\n\t\tfor (var i = 0; firstItem && i < this.children.length; i++) {\n\t\t\tif (this.children[i].type !== \"staff-extra\")\n\t\t\t\tfirstItem = false;\n\t\t}\n\t\tif (!firstItem) {\n\t\t\tthis.beams.push(\"bar\");\n\t\t\tthis.otherchildren.push(\"bar\");\n\t\t}\n\t}\n\tthis.children[this.children.length] = child;\n\tthis.setRange(child);\n};\n\nVoiceElement.prototype.setLimit = function(member, child) {\n\t// Sometimes we get an absolute element in here and sometimes we get some type of relative element.\n\t// If there is a \"specialY\" element, then assume it is an absolute element. If that doesn't exist, look for the\n\t// same members at the top level, because that's where they are in relative elements.\n\tvar specialY = child.specialY;\n\tif (!specialY) specialY = child;\n\tif (!specialY[member]) return;\n\tif (!this.specialY[member])\n\t\tthis.specialY[member] = specialY[member];\n\telse\n\t\tthis.specialY[member] = Math.max(this.specialY[member], specialY[member]);\n};\n\nVoiceElement.prototype.moveDecorations = function(beam) {\n\tvar padding = 1.5; // This is the vertical padding between elements, in pitches.\n\tfor (var ch = 0; ch < beam.elems.length; ch++) {\n\t\tvar child = beam.elems[ch];\n\t\tif (child.top) {\n\t\t\t// We now know where the ornaments should have been placed, so move them if they would overlap.\n\t\t\tvar top = beam.yAtNote(child);\n\t\t\tfor (var i = 0; i < child.children.length; i++) {\n\t\t\t\tvar el = child.children[i];\n\t\t\t\tif (el.klass === 'ornament') {\n\t\t\t\t\tif (el.bottom - padding < top) {\n\t\t\t\t\t\tvar distance = top - el.bottom + padding; // Find the distance that it needs to move and add a little margin so the element doesn't touch the beam.\n\t\t\t\t\t\tel.bottom += distance;\n\t\t\t\t\t\tel.top += distance;\n\t\t\t\t\t\tel.pitch += distance;\n\t\t\t\t\t\ttop = child.top = el.top;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\nVoiceElement.prototype.adjustRange = function(child) {\n\tif (child.bottom !== undefined)\n\t\tthis.bottom = Math.min(this.bottom, child.bottom);\n\tif (child.top !== undefined)\n\t\tthis.top = Math.max(this.top, child.top);\n};\n\nVoiceElement.prototype.setRange = function(child) {\n\tthis.adjustRange(child);\n\tthis.setLimit('tempoHeightAbove', child);\n\tthis.setLimit('partHeightAbove', child);\n\tthis.setLimit('volumeHeightAbove', child);\n\tthis.setLimit('dynamicHeightAbove', child);\n\tthis.setLimit('endingHeightAbove', child);\n\tthis.setLimit('chordHeightAbove', child);\n\tthis.setLimit('lyricHeightAbove', child);\n\tthis.setLimit('lyricHeightBelow', child);\n\tthis.setLimit('chordHeightBelow', child);\n\tthis.setLimit('volumeHeightBelow', child);\n\tthis.setLimit('dynamicHeightBelow', child);\n};\n\nVoiceElement.prototype.setUpperAndLowerElements = function(positionY) {\n\tvar i;\n\tfor (i = 0; i < this.children.length; i++) {\n\t\tvar abselem = this.children[i];\n\t\tabselem.setUpperAndLowerElements(positionY);\n\t}\n\tfor (i = 0; i < this.otherchildren.length; i++) {\n\t\tvar abselem = this.otherchildren[i];\n\t\tif (typeof abselem !== 'string')\n\t\t\tabselem.setUpperAndLowerElements(positionY);\n\t}\n};\n\nVoiceElement.prototype.addOther = function (child) {\n\tthis.otherchildren.push(child);\n\tthis.setRange(child);\n};\n\nVoiceElement.prototype.addBeam = function (child) {\n\tthis.beams.push(child);\n};\n\nVoiceElement.prototype.updateIndices = function () {\n\tif (!this.layoutEnded()) {\n\t\tthis.durationindex += this.children[this.i].duration;\n\t\tif (this.children[this.i].duration===0) this.durationindex = Math.round(this.durationindex*64)/64; // everytime we meet a barline, do rounding to nearest 64th\n\t\tthis.i++;\n\t}\n};\n\nVoiceElement.prototype.layoutEnded = function () {\n\treturn (this.i>=this.children.length);\n};\n\nVoiceElement.prototype.getDurationIndex = function () {\n\treturn this.durationindex - (this.children[this.i] && (this.children[this.i].duration>0)?0:0.0000005); // if the ith element doesn't have a duration (is not a note), its duration index is fractionally before. This enables CLEF KEYSIG TIMESIG PART, etc. to be laid out before we get to the first note of other voices\n};\n\n// number of spacing units expected for next positioning\nVoiceElement.prototype.getSpacingUnits = function () {\n\treturn Math.sqrt(this.spacingduration*8);\n\t// TODO-PER: On short lines, this would never trigger, so the spacing was wrong. I just changed this line empirically, though, so I don't know if there are other ramifications.\n\t//return (this.minx<this.nextx) ? Math.sqrt(this.spacingduration*8) : 0; // we haven't used any spacing units if we end up using minx\n};\n\n//\nVoiceElement.prototype.getNextX = function () {\n\treturn Math.max(this.minx, this.nextx);\n};\n\nVoiceElement.prototype.beginLayout = function (startx) {\n\tthis.i=0;\n\tthis.durationindex=0;\n\t//this.ii=this.children.length;\n\tthis.startx=startx;\n\tthis.minx=startx; // furthest left to where negatively positioned elements are allowed to go\n\tthis.nextx=startx; // x position where the next element of this voice should be placed assuming no other voices and no fixed width constraints\n\tthis.spacingduration=0; // duration left to be laid out in current iteration (omitting additional spacing due to other aspects, such as bars, dots, sharps and flats)\n};\n\n// Try to layout the element at index this.i\n// x - position to try to layout the element at\n// spacing - base spacing\n// can't call this function more than once per iteration\nVoiceElement.prototype.layoutOneItem = function (x, spacing) {\n\tvar child = this.children[this.i];\n\tif (!child) return 0;\n\tvar er = x - this.minx; // available extrawidth to the left\n\tif (er<child.getExtraWidth()) { // shift right by needed amount\n\t\tx+=child.getExtraWidth()-er;\n\t}\n\tchild.setX(x);\n\n\tthis.spacingduration = child.duration;\n\t//update minx\n\tthis.minx = x+child.getMinWidth(); // add necessary layout space\n\tif (this.i!==this.children.length-1) this.minx+=child.minspacing; // add minimumspacing except on last elem\n\n\tthis.updateNextX(x, spacing);\n\n\t// contribute to staff y position\n\t//this.staff.top = Math.max(child.top,this.staff.top);\n\t//this.staff.bottom = Math.min(child.bottom,this.staff.bottom);\n\n\treturn x; // where we end up having placed the child\n};\n\n// call when spacingduration has been updated\nVoiceElement.prototype.updateNextX = function (x, spacing) {\n\tthis.nextx= x + (spacing*Math.sqrt(this.spacingduration*8));\n};\n\nVoiceElement.prototype.shiftRight = function (dx) {\n\tvar child = this.children[this.i];\n\tif (!child) return;\n\tchild.setX(child.x+dx);\n\tthis.minx+=dx;\n\tthis.nextx+=dx;\n};\n\nVoiceElement.prototype.draw = function (renderer, bartop) {\n\tvar width = this.w-1;\n\trenderer.staffbottom = this.staff.bottom;\n\t//this.barbottom = renderer.calcY(2);\n\n\trenderer.measureNumber = null;\n\trenderer.noteNumber = null;\n\tif (this.header) { // print voice name\n\t\tvar textpitch = 14 - (this.voicenumber+1)*(12/(this.voicetotal+1));\n\t\trenderer.renderText(renderer.padding.left, renderer.calcY(textpitch), this.header, 'voicefont', 'staff-extra voice-name', 'start');\n\t}\n\n\tfor (var i=0, ii=this.children.length; i<ii; i++) {\n\t\tvar child = this.children[i];\n\t\tvar justInitializedMeasureNumber = false;\n\t\tif (child.type !== 'staff-extra' && renderer.measureNumber === null) {\n\t\t\trenderer.measureNumber = 0;\n\t\t\trenderer.noteNumber = 0;\n\t\t\tjustInitializedMeasureNumber = true;\n\t\t}\n\t\tchild.draw(renderer, (this.barto || i===ii-1)?bartop:0);\n\t\tif (child.type === 'note')\n\t\t\trenderer.noteNumber++;\n\t\tif (child.type === 'bar' && !justInitializedMeasureNumber) {\n\t\t\trenderer.measureNumber++;\n\t\t\trenderer.noteNumber = 0;\n\t\t}\n\t}\n\n\trenderer.measureNumber = 0;\n\trenderer.noteNumber = 0;\n\tparseCommon.each(this.beams, function(beam) {\n\t\tif (beam === 'bar') {\n\t\t\trenderer.measureNumber++;\n\t\t\trenderer.noteNumber = 0;\n\t\t} else\n\t\t\tbeam.draw(renderer); // beams must be drawn first for proper printing of triplets, slurs and ties.\n\t});\n\n\trenderer.measureNumber = 0;\n\trenderer.noteNumber = 0;\n\tvar self = this;\n\tparseCommon.each(this.otherchildren, function(child) {\n\t\tif (child === 'bar') {\n\t\t\trenderer.measureNumber++;\n\t\t\trenderer.noteNumber = 0;\n\t\t} else\n\t\t\tchild.draw(renderer,self.startx+10,width);\n\t});\n\n};\n\nVoiceElement.prototype.layoutBeams = function() {\n\tfor (var i = 0; i < this.beams.length; i++) {\n\t\tif (this.beams[i].layout) {\n\t\t\tthis.beams[i].layout();\n\t\t\tthis.moveDecorations(this.beams[i]);\n\t\t\t// The above will change the top and bottom of the abselem children, so see if we need to expand our range.\n\t\t\tfor (var j = 0; j < this.beams[i].elems.length; j++) {\n\t\t\t\tthis.adjustRange(this.beams[i].elems[j]);\n\t\t\t}\n\t\t}\n\t}\n\t// Now we can layout the triplets\n\tfor (i = 0; i < this.otherchildren.length; i++) {\n\t\tvar child = this.otherchildren[i];\n\t\tif (child.layout)\n\t\t\tchild.layout();\n\t}\n\tthis.staff.top = Math.max(this.staff.top, this.top);\n\tthis.staff.bottom = Math.min(this.staff.bottom, this.bottom);\n};\n\nmodule.exports = VoiceElement;\n"]},"metadata":{},"sourceType":"script"}